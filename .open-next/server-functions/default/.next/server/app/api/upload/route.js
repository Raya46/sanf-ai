(()=>{var e={};e.id=413,e.ids=[413],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8719:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isRequestAPICallableInsideAfter:function(){return c},throwForSearchParamsAccessInUseCache:function(){return o},throwWithStaticGenerationBailoutError:function(){return n},throwWithStaticGenerationBailoutErrorWithDynamicError:function(){return a}});let s=r(80023),i=r(3295);function n(e,t){throw Object.defineProperty(new s.StaticGenBailoutError(`Route ${e} couldn't be rendered statically because it used ${t}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E576",enumerable:!1,configurable:!0})}function a(e,t){throw Object.defineProperty(new s.StaticGenBailoutError(`Route ${e} with \`dynamic = "error"\` couldn't be rendered statically because it used ${t}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E543",enumerable:!1,configurable:!0})}function o(e){let t=Object.defineProperty(Error(`Route ${e.route} used "searchParams" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "searchParams" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E634",enumerable:!1,configurable:!0});throw e.invalidUsageError??=t,t}function c(){let e=i.afterTaskAsyncStorage.getStore();return(null==e?void 0:e.rootTaskSpawnPhase)==="action"}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43763:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}static set(e,t,r,s){return Reflect.set(e,t,r,s)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{describeHasCheckingStringProperty:function(){return i},describeStringPropertyAccess:function(){return s},wellKnownProperties:function(){return n}});let r=/^[A-Za-z_$][A-Za-z0-9_$]*$/;function s(e,t){return r.test(t)?"`"+e+"."+t+"`":"`"+e+"["+JSON.stringify(t)+"]`"}function i(e,t){let r=JSON.stringify(t);return"`Reflect.has("+e+", "+r+")`, `"+r+" in "+e+"`, or similar"}let n=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","valueOf","toLocaleString","then","catch","finally","status","displayName","toJSON","$$typeof","__esModule"])},78335:()=>{},82642:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>_,routeModule:()=>x,serverHooks:()=>T,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{POST:()=>P});var i=r(96559),n=r(48088),a=r(37719);let o=new TextEncoder,c={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},u=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class h{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:r,service:s,region:i,cache:n,retries:a,initRetryMs:o}){if(null==e)throw TypeError("accessKeyId is a required option");if(null==t)throw TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=r,this.service=s,this.region=i,this.cache=n||new Map,this.retries=null!=a?a:10,this.initRetryMs=o||50}async sign(e,t){if(e instanceof Request){let{method:r,url:s,headers:i,body:n}=e;null==(t=Object.assign({method:r,url:s,headers:i},t)).body&&i.has("Content-Type")&&(t.body=null!=n&&i.has("X-Amz-Content-Sha256")?n:await e.clone().arrayBuffer()),e=s}let r=new l(Object.assign({url:e.toString()},t,this,t&&t.aws)),s=Object.assign({},t,await r.sign());delete s.aws;try{return new Request(s.url.toString(),s)}catch(e){if(e instanceof TypeError)return new Request(s.url.toString(),Object.assign({duplex:"half"},s));throw e}}async fetch(e,t){for(let r=0;r<=this.retries;r++){let s=fetch(await this.sign(e,t));if(r===this.retries)return s;let i=await s;if(i.status<500&&429!==i.status)return i;await new Promise(e=>setTimeout(e,Math.random()*this.initRetryMs*Math.pow(2,r)))}throw Error("An unknown error occurred, ensure retries is not negative")}}class l{constructor({method:e,url:t,headers:r,body:s,accessKeyId:i,secretAccessKey:n,sessionToken:a,service:o,region:h,cache:l,datetime:d,signQuery:p,appendSessionToken:g,allHeaders:f,singleEncode:y}){let w,S;if(null==t)throw TypeError("url is a required option");if(null==i)throw TypeError("accessKeyId is a required option");if(null==n)throw TypeError("secretAccessKey is a required option");this.method=e||(s?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(r||{}),this.body=s,this.accessKeyId=i,this.secretAccessKey=n,this.sessionToken=a,o&&h||([w,S]=function(e,t){let{hostname:r,pathname:s}=e;if(r.endsWith(".on.aws")){let e=r.match(/^[^.]{1,63}\.lambda-url\.([^.]{1,63})\.on\.aws$/);return null!=e?["lambda",e[1]||""]:["",""]}if(r.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(r.endsWith(".backblazeb2.com")){let e=r.match(/^(?:[^.]{1,63}\.)?s3\.([^.]{1,63})\.backblazeb2\.com$/);return null!=e?["s3",e[1]||""]:["",""]}let i=r.replace("dualstack.","").match(/([^.]{1,63})\.(?:([^.]{0,63})\.)?amazonaws\.com(?:\.cn)?$/),n=i&&i[1]||"",a=i&&i[2];if("us-gov"===a)a="us-gov-west-1";else if("s3"===a||"s3-accelerate"===a)a="us-east-1",n="s3";else if("iot"===n)n=r.startsWith("iot.")?"execute-api":r.startsWith("data.jobs.iot.")?"iot-jobs-data":"/mqtt"===s?"iotdevicegateway":"iotdata";else if("autoscaling"===n){let e=(t.get("X-Amz-Target")||"").split(".")[0];"AnyScaleFrontendService"===e?n="application-autoscaling":"AnyScaleScalingPlannerFrontendService"===e&&(n="autoscaling-plans")}else null==a&&n.startsWith("s3-")?(a=n.slice(3).replace(/^fips-|^external-1/,""),n="s3"):n.endsWith("-fips")?n=n.slice(0,-5):a&&/-\d$/.test(n)&&!/-\d$/.test(a)&&([n,a]=[a,n]);return[c[n]||n,a||""]}(this.url,this.headers)),this.service=o||w||"",this.region=h||S||"us-east-1",this.cache=l||new Map,this.datetime=d||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=p,this.appendSessionToken=g||"iotdevicegateway"===this.service,this.headers.delete("Host"),"s3"!==this.service||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");let b=this.signQuery?this.url.searchParams:this.headers;if(b.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&b.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(e=>f||!u.has(e)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(e=>e+":"+("host"===e?this.url.host:(this.headers.get(e)||"").replace(/\s+/g," "))).join("\n"),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&("s3"!==this.service||b.has("X-Amz-Expires")||b.set("X-Amz-Expires","86400"),b.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),b.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),b.set("X-Amz-SignedHeaders",this.signedHeaders)),"s3"===this.service)try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch(e){this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");y||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=m(this.encodedPath);let A=new Set;this.encodedSearch=[...this.url.searchParams].filter(([e])=>{if(!e)return!1;if("s3"===this.service){if(A.has(e))return!1;A.add(e)}return!0}).map(e=>e.map(e=>m(encodeURIComponent(e)))).sort(([e,t],[r,s])=>e<r?-1:e>r?1:t<s?-1:+(t>s)).map(e=>e.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){let e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join(),r=this.cache.get(t);if(!r){let s=await d("AWS4"+this.secretAccessKey,e),i=await d(s,this.region),n=await d(i,this.service);r=await d(n,"aws4_request"),this.cache.set(t,r)}return f(await d(r,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,f(await p(await this.canonicalString()))].join("\n")}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+"\n",this.signedHeaders,await this.hexBodyHash()].join("\n")}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||("s3"===this.service&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(null==e){if(this.body&&"string"!=typeof this.body&&!("byteLength"in this.body))throw Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=f(await p(this.body||""))}return e}}async function d(e,t){let r=await crypto.subtle.importKey("raw","string"==typeof e?o.encode(e):e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",r,o.encode(t))}async function p(e){return crypto.subtle.digest("SHA-256","string"==typeof e?o.encode(e):e)}let g=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function f(e){let t=new Uint8Array(e),r="";for(let e=0;e<t.length;e++){let s=t[e];r+=g[s>>>4&15],r+=g[15&s]}return r}function m(e){return e.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var y=r(32190);let w=process.env.R2_ACCESS_KEY_ID||"",S=process.env.R2_SECRET_ACCESS_KEY||"",b=process.env.R2_ACCOUNT_ID||"",A=process.env.R2_BUCKET_NAME||"",v=`https://${b}.r2.cloudflarestorage.com`;w&&S&&b&&A||console.error("R2 configuration missing in environment variables");let E=new h({accessKeyId:w,secretAccessKey:S,service:"s3",region:"auto"});async function P(e){try{let t=await e.formData(),r=t.get("file"),s=t.get("key"),i=t.get("original_filename"),n=t.get("user_id"),a=t.get("user_email");if(!r||!s)return y.NextResponse.json({error:"File or key not provided."},{status:400});let o=Buffer.from(await r.arrayBuffer()),c=`${v}/${A}/${s}`,u={"Content-Type":r.type,"Content-Length":o.length.toString()};i&&(u["x-amz-meta-original-filename"]=i),n&&(u["x-amz-meta-user-id"]=n),a&&(u["x-amz-meta-user-email"]=a);let h=await E.fetch(c,{method:"PUT",headers:u,body:o});if(!h.ok){let e=await h.text();throw console.error(`S3 upload failed: ${h.status} ${h.statusText}`,{errorText:e}),Error(`S3 upload failed: ${h.status} ${h.statusText}`)}let l=`${v}/${A}/${s}`;return y.NextResponse.json({success:!0,url:l,key:s})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error("Server: Error uploading file:",e),y.NextResponse.json({error:e},{status:500})}}let x=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\Users\\raya\\project\\belajar_nextjs\\sanf-ai\\src\\app\\api\\upload\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:R,workUnitAsyncStorage:j,serverHooks:T}=x;function _(){return(0,a.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:j})}},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580],()=>r(82642));module.exports=s})();