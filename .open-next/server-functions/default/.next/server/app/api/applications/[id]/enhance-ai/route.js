(()=>{var e={};e.id=407,e.ids=[407],e.modules={659:()=>{},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},17203:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{OPTIONS:()=>l,POST:()=>p});var n=r(81248),o=r(5892),i=r(32190),a=r(28402),c=r(76033),u=e([a]);async function p(e,{params:t}){let{id:r}=await t,s=await (0,c.U)();try{let{currentContent:t,userPrompt:c}=await e.json();if(!r)return new Response("Missing applicationId",{status:400});let{data:{user:u}}=await s.auth.getUser();if(!u)return new Response("Unauthorized",{status:401});let p=function(){let e=process.env.OPENAI_API_KEY,t=null;try{let{env:r}=(0,a.getCloudflareContext)();t=r.AI,e=r.OPENAI_API_KEY}catch(e){console.error("Failed to access Cloudflare context in production:",e),globalThis.AI&&(t=globalThis.AI)}if(!e||0===e.length)throw Error("OPENAI_API_KEY not found or is empty in environment");return{AI:t,OPENAI_API_KEY:e}}(),l=(0,n.r)({baseURL:"https://openrouter.ai/api/v1",apiKey:p.OPENAI_API_KEY}),{data:d,error:h}=await s.from("credit_applications").select("company_type, amount").eq("id",r).single();if(h||!d)return console.error("Error fetching application data for enhancement:",h),new Response("Application data not found",{status:404});let{company_type:x,amount:y}=d,g=[{role:"system",content:`You are an AI assistant tasked with enhancing a credit analysis report. The current report content is provided. The company type is "${x}" and the requested amount is ${y}. Enhance the report based on the user's prompt. Only output the enhanced report content in **pure HTML format**. Ensure proper line breaks and spacing using HTML tags like <br> or by structuring content within block-level elements. Do NOT use Markdown syntax (e.g., **bold**, *italic*, - list item) in the output.`},{role:"assistant",content:t},{role:"user",content:c}],m=(await (0,o.gM)({model:l("gpt-4o-mini"),messages:g})).toDataStream();return new i.NextResponse(m,{headers:{"Content-Type":"text/plain; charset=utf-8"}})}catch(t){console.error("Error in AI enhancement route:",t);let e=t instanceof Error?t.message:"An unknown error occurred";return new Response(e,{status:500})}}async function l(){return new Response(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}a=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},23370:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>u,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var n=r(96559),o=r(48088),i=r(37719),a=r(17203),c=e([a]);a=(c.then?(await c)():c)[0];let p=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/applications/[id]/enhance-ai/route",pathname:"/api/applications/[id]/enhance-ai",filename:"route",bundlePath:"app/api/applications/[id]/enhance-ai/route"},resolvedPagePath:"C:\\Users\\raya\\project\\belajar_nextjs\\sanf-ai\\src\\app\\api\\applications\\[id]\\enhance-ai\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:h}=p;function u(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}s()}catch(e){s(e)}})},27910:e=>{"use strict";e.exports=require("stream")},28402:e=>{"use strict";e.exports=import("@opennextjs/cloudflare")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76033:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var s=r(80261),n=r(44999);let o=async()=>{let e=await (0,n.UL)();return(0,s.createServerClient)("https://gskcziircorxypqexcuh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdza2N6aWlyY29yeHlwcWV4Y3VoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1OTUyMTMsImV4cCI6MjA2NjE3MTIxM30.gQg76c18soHVeuRqxjnPiIji088qp7NTVguZUsyePDM",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>{e.set(t,r,s)})}catch{console.log("Cookie setting error in Server Component - can be ignored if using middleware")}}}})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},84882:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,875,580,576,9],()=>r(23370));module.exports=s})();